module formatstrings;

macro import std.macro.assert;

void main() {
    int i = 5;
    assert("i = $i" == "i = 5");
    float f = 1.5f, g = 3.0f;
    assert("$f and $g" == "1.500000 and 3.000000");
    assert("the sum is $(f + g)." == "the sum is 4.500000.");
    long l;
    assert("$(l)" == "0"); // long
    int[] a;
    assert("$(a.length)" == "0"); // size_t
    testTypes;
}

void testTypes() {
    assert("$(2)" == "2");
    assert("$(2.0f)" == "2.000000");
    assert("$(2.0)" == "2.000000");
    assert("$(cast(short) 2)" == "2");
    assert("$(cast(ubyte) 2)" == "2");
    assert("$(true)" == "true");
    assert("$([2, 3, 4])" == "[2, 3, 4]");
    assert("$(A(2))" == "A(i=2)");
    assert("$(null)" == "null");
    assert("$(cast(void*) null)" == "null");
    assert("$(cast(void*) 1)" == ("0x00000000000001" if sizeof(size_t) == 8 else "0x00000001"));
    assert("$(:foo)" == ":foo");
}

struct A {
    int i;
    // FIXME autogen
    string toString() return "A(i=$i)";
}
